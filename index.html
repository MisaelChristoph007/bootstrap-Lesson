<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="style.css">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Latihan bootstrap</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <script defer src="https://use.fontawesome.com/releases/v5.8.1/js/all.js"
    integrity="sha384-g5uSoOSBd7KkhAMlnQILrecXvzst9TdC09/VM+pjDTCM+1il8RHz5fKANTFFb+gQ"
    crossorigin="anonymous"></script>
</head>
<body>
<div class="container">
  <nav class="navbar navbar-light bg-light">
    <a class="navbar-brand">ArdiPurworejo Store</a>
    <form class="form-inline">
      <input class="form-control mr-sm-2" type="search" placeholder="Search" id="keyword" aria-label="Search">
      <button class="btn btn-outline-success my-2 my-sm-0" id="searchButton">Search</button>
    </form>
    <button class="btn btn-primary" id="cart" data-toggle="modal" data-target="#cartPopup"><i class="fas fa-shopping-cart"></i><span id="cartItemCount"> (0)</span></button>
    <button class="btn btn-danger" id="clearCartButton">Clear All</button>
  </nav>
  <div class="row">
    <div class="row col-md-12 mt-2" id="listBarang">
      <!-- Produk lainnya ... -->
    </div>
  </div>
</div>
<div class="modal fade" id="cartPopup" tabindex="-1" role="dialog" aria-labelledby="cartPopupLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="cartPopupLabel">Your Cart</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <table class="show-cart-popup table"></table>
        <div class="total-price-popup">Total: $<span class="total-cart-popup"></span></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="orderButton">Order now</button>
        <button type="button" class="btn btn-danger" id="clearCartButton">Clear Cart</button>
      </div>
    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
  integrity="sha384-q8i/X+965dzO0rT7abK41JStQIAqVgRVzpbzo5smXn2x2Bw21" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
  integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
  crossorigin="anonymous"></script>
<script>
  let previousCartItemCount = 0; // Variabel untuk menyimpan jumlah item keranjang sebelumnya

  const cart = {
    items: [],

    addItem: function (name, price) {
      this.items.push({ name, price });
    },

    getTotalPrice: function () {
      return this.items.reduce((total, item) => total + item.price, 0);
    },

    clearCart: function () {
      this.items = [];
    },
  };

  // Function to update the cart and cart modal
  function updateCart() {
    const showCartTable = document.querySelector('.show-cart-popup');
    const totalCartSpan = document.querySelector('.total-cart-popup');
    showCartTable.innerHTML = '';
    cart.items.forEach((item) => {
      showCartTable.innerHTML += `<tr><td>${item.name}</td><td>$${item.price.toFixed(2)}</td></tr>`;
    });
    totalCartSpan.textContent = cart.getTotalPrice().toFixed(2);
    document.getElementById('cartItemCount').textContent = ` (${cart.items.length})`;
  }

  // Function to update the cart button text
  function updateCartButton() {
    const cartItemCount = cart.items.length;
    const cartButton = document.getElementById('cart');

    if (cartItemCount > 9) {
      cartButton.innerHTML = `<i class="fas fa-shopping-cart"></i><span id="cartItemCount"> (9+)</span>`;
    } else {
      cartButton.innerHTML = `<i class="fas fa-shopping-cart"></i><span id="cartItemCount"> (${cartItemCount})</span>`;
    }

    // Update previousCartItemCount setelah tombol diperbarui
    previousCartItemCount = cartItemCount;
  }

  // Handle the "Order now" button click
  document.getElementById('orderButton').addEventListener('click', () => {
    Swal.fire('Order Placed', 'Your order has been placed successfully!', 'success');
    cart.clearCart();
    updateCart();
    updateCartButton();
    $('#cartPopup').modal('hide');
  });

  // Search functionality
  document.getElementById('searchButton').addEventListener('click', (event) => {
    event.preventDefault();
    const keyword = document.getElementById('keyword').value.toLowerCase();
    const cards = document.querySelectorAll('.card');

    // Hapus pesan peringatan sebelum menambahkannya kembali
    const noResultMessage = document.querySelector('.no-result-message');
    if (noResultMessage) {
      noResultMessage.remove();
    }

    let isResultFound = false;

    cards.forEach((card) => {
      const title = card.querySelector('.card-title').textContent.toLowerCase();
      if (title.includes(keyword) || keyword === '') {
        card.style.display = 'block';
        isResultFound = true;
      } else {
        card.style display = 'none';
      }
    });

    if (!isResultFound) {
      const noResultMessage = document.createElement('p');
      noResultMessage.textContent = 'Produk/Barang tidak tersedia';
      noResultMessage.classList.add('text-danger', 'no-result-message');
      document.getElementById('listBarang').appendChild(noResultMessage);
    }
  });

  // Handle the "Clear Cart" button click
  document.getElementById('clearCartButton').addEventListener('click', () => {
    cart.clearCart();
    updateCart();
    updateCartButton();
    Swal.fire('Cart Cleared', 'Your cart has been cleared.', 'success');
  });

  document.querySelectorAll('.add-to-cart').forEach((button) => {
    button.addEventListener('click', (event) => {
      event.preventDefault();
      const name = button.getAttribute('data-name');
      const price = parseFloat(button.getAttribute('data-price'));
      cart.addItem(name, price);
      updateCart();
      updateCartButton();
      Swal.fire('Sukses ditambahkan!', `${name} ditambahkan ke keranjang!`, 'success');
    });
  });

  // Handle the cart button click to open the cart popup
  document.getElementById('cart').addEventListener('click', () => {
    updateCart();
    $('#cartPopup').modal('show');
  });
</script>
</body>
</html>
